{% extends "report/base.html" %}

{% block page_title %}Expired Hosts Report{% endblock %}

{% load staticfiles %}

{% block extrahead %}

<style type="text/css">
  .m-b-md {
    margin-bottom: 20px;
  }

  .content {
    margin: 20px;
  }
</style>
{% endblock %} {% block content %}

<div
  id="confirm-modal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-hidden="true"
  style="display: none"
> </div>

<div class="content">
  <h1>Expired Hosts</h1>
  <p>
    Report includes static hosts which expired in the past 5 years or more, and
    dynamic hosts in the past 2 years or more. In both cases, the hosts must
    also have been seen on the network recently.
  </p>
  <button class="btn btn-primary" id="toggle-checks">
    <span class="glyphicon glyphicon-check"></span>
    Toggle All Checkboxes
  </button>
  <div class="row">
    {% if host_types.static or host_types.dynamic %}
    <div class="col-lg-12">
      {% if host_types.static %}
      <h2>Static Hosts - ({{host_types.static|length}})</h2>

      <form method="post" action="/api/hosts/bulk_delete/" id="static_hosts" autocomplete="off">
        {% csrf_token %}
        <button class="btn btn-danger m-b-md">
          <span class="glyphicon glyphicon-trash"></span> Delete Selected
        </button>
        <table class="table table-striped table-condensed table-bordered">
          <thead>
            <tr>
              <td>Delete</td>
              <th>Host</th>
              <th>Mac Address</th>
              <th>Expired</th>
            </tr>
          </thead>
          <tbody>
            {% for host in host_types.static %}
            <tr>
              <td>
                <input
                  type="checkbox"
                  name="mac_addr[]"
                  value="{{host.mac}}"
                />
              </td>
              <td>{{ host.hostname }}</td>
              <td>{{ host.mac }}</td>
              <td>{{ host.expires }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </form>
      {% endif %} {% if host_types.dynamic %}
      <h2>Dynamic Hosts - ({{host_types.dynamic|length}})</h2>
      <form method="post" action="/api/hosts/bulk_delete/" id="dynamic_hosts" autocomplete="off">
        {% csrf_token %}
        <button class="btn btn-danger m-b-md">
          <span class="glyphicon glyphicon-trash"></span> Delete Selected
        </button>
        <table class="table table-striped table-condensed table-bordered">
          <thead>
            <tr>
              <td>Delete</td>
              <th>Host</th>
              <th>Mac Address</th>
              <th>Expired</th>
            </tr>
          </thead>
          <tbody>
            {% for host in host_types.dynamic %}
            <tr>
              <td>
                <input
                  type="checkbox"
                  name="mac_addr[]"
                  value="{{host.mac}}"
                />
              </td>
              <td>{{ host.hostname }}</td>
              <td>{{ host.mac }}</td>
              <td>{{ host.expires }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </form>

      {% endif %}
    </div>
    {% else %}
    <p>No expired hosts! :)</p>
    {% endif %}
  </div>
</div>

<script type="text/javascript" src="{% static 'report/js/host/confirm_modal.js' %}"></script>
<script type="text/javascript" src="{% static 'report/js/host/multiselect_host_form.js' %}" defer></script>
<script>
  $("#static_hosts").on("submit", function(e) {
    e.preventDefault();
    $("#confirm-modal").confirmHostsModal("Delete Static Hosts", `Are you sure you want to delete ${macCount(this)} static hosts?`,
      () => submitForm(this),
      () => window.location.reload(), 
    );
    return false;
  });

  $("#dynamic_hosts").on("submit", function(e) {
    e.preventDefault();
    $("#confirm-modal").confirmHostsModal("Delete Dynamic Hosts", `Are you sure you want to delete ${macCount(this)} dynamic hosts?`,
      () => submitForm(this),
      () => window.location.reload(), 
    );
    return false;
  });
</script>
{% endblock %}
